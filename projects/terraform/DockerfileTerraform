FROM ubuntu:22.04

RUN apt-get update -y && \
    apt-get install -y gnupg software-properties-common curl

RUN curl https://apt.releases.hashicorp.com/gpg | gpg --dearmor > hashicorp.gpg
RUN install -o root -g root -m 644 hashicorp.gpg /etc/apt/trusted.gpg.d/
RUN apt-add-repository "deb [arch=$(dpkg --print-architecture)] https://apt.releases.hashicorp.com $(lsb_release -cs) main"
RUN apt install terraform

COPY hello_world.tf .

RUN terraform init

CMD ["terraform", "apply", "-auto-approve"]
# TODO make this output one line